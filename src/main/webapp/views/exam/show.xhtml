<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<ui:composition template="../common/template.xhtml">
    <ui:define name="head">
        <f:metadata>
            <f:event type="preRenderView" listener="#{examView.setExamId(exam.id)}" />
        </f:metadata>
    </ui:define>
    <ui:define name="content">
        <h:form>
            <h1>Exam #{exam.name}</h1>
            <p:link href="/exam/#{exam.id}/result" value="Exam result"/><br/>
            <div style="display: flex;">
                <div>
                    <ui:repeat var="question" value="#{exam.questions}">
                        <h2>#{question.question}</h2>
                        Time: #{question.secondsForAnswer}
                        <ui:repeat var="answer" value="#{question.answers}">
                            <p:outputLabel style="#{answer.valid  ? 'color:green;' : ''}">
                                <h3>#{answer.answer}</h3>
                            </p:outputLabel>
                        </ui:repeat>
                    </ui:repeat>
                </div>
                <div style="margin-left: 10%;">
                    <p:messages autoUpdate="true" showDetail="true" closable="true"/>
                    <h4>Assign to students</h4>
                    <p:selectOneMenu id="class" value="#{examView.selectedClass}" editable="true">
                        <p:ajax listener="#{examView.onClassChange}" update="users" />
                        <f:selectItems value="#{examView.schoolClasses}" />
                    </p:selectOneMenu>
                    <p:outputPanel id="users">
                        <p:dataTable var="user" value="#{examView.selectedUsers}" >
                            <p:column headerText="Login" sortBy="#{user.nickname}">
                                <h:outputText value="#{user.nickname}" />
                            </p:column>
                            <p:column headerText="Class" sortBy="#{user.schoolClass}">
                                <h:outputText value="#{user.schoolClass}" />
                            </p:column>
                            <p:column headerText="Class Id" sortBy="#{user.idInClass}">
                                <h:outputText value="#{user.idInClass}" />
                            </p:column>
                            <p:column headerText="Creation date" sortBy="#{user.creationDate}">
                                <h:outputText value="#{user.creationDate}" />
                            </p:column>
                        </p:dataTable>
                        <p:commandButton value="Assign" actionListener="#{examView.assignUsersToExam()}"/>
                    </p:outputPanel>
                </div>
            </div>
        </h:form>
    </ui:define>
</ui:composition>
</html>